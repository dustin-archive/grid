@mixin generate-grids(
  $gutter-width  : $taffy-gutter-width,
  $gutter-height : $taffy-gutter-height,
  $amount        : $taffy-amount,
  $media         : null
  ) {

  // Grid placeholders
  @if $media {
    %#{dash(grid all $media)} {
      margin-top: em($gutter-height);
      margin-right: em($gutter-width);
    }
    %#{dash(grid first row $media)} {
      margin-top: 0;
    }
    %#{dash(grid last column $media)} {
      margin-right: 0;
    }
  }
  @else {
    %grid-all {
      margin-top: em($gutter-height);
      margin-right: em($gutter-width);
    }
    %grid-first-row {
      margin-top: 0;
    }
    %grid-last-column {
      margin-right: 0;
    }
  }

  // Grids
  @for $i from 1 through $amount {
    %#{dash(grid $i $media)} {
      > [class^='column'] {

        // Nth-child
        &:nth-child(n) {
          @if $media {
            @extend %#{dash(grid all $media)};
          }
          @else {
            @extend %grid-all;
          }
        }

        // First row
        &:nth-child(-n + #{$i}) {
          @if $media {
            @extend %#{dash(grid first row $media)};
          }
          @else {
            @extend %grid-first-row;
          }
        }

        // Last column and last child
        &:nth-child(#{$i}n),
        &:last-child {
          @if $media {
            @extend %#{dash(grid last column $media)};
          }
          @else {
            @extend %grid-last-column;
          }
        }
      }
    }
  }
}
